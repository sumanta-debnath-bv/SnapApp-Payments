<body>
    <meta charset="UTF-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" /> 
    <title>Account Settings - SnapApp™
    </title>
    <style>
        .d-none {
            display: none !important;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <div class="main-container d-none">
        <div class="page-header">
            <h1 class="page-title">Account Settings</h1>
        </div>
        <div class="tab-navigation">
            <button data-tab="overview" class="tab-button active"><span class="material-icons">dashboard</span>
                Overview
            </button>
            <button data-tab="management" class="tab-button"><span class="material-icons">manage_accounts</span>
                Management
            </button>
            <button data-tab="products" class="tab-button"><span class="material-icons">inventory_2</span>
                Products
            </button>
            <div style="margin-left: auto; display: flex; gap: 12px; align-items: center;">
                <button id="viewCartBtn" class="tab-action-btn"
                    style="display: none; margin-left: 0; border: none !important;"><span
                        class="material-icons">shopping_cart</span> View Cart</button>
                <a href="/form-view/update-account/[[id]]" class="tab-action-btn" style="margin-left: 0;"><span
                        class="material-icons">edit</span> Update Account</a>
            </div>
        </div>
        <input id="tenant-id" type="hidden" value="[[id]]" />
        <div id="overview-tab" class="tab-content active">
            <div class="card-section">
                <h2 class="card-title">Account Information
                </h2>
                <div class="form-grid">
                    <!-- Name -->
                    <div class="form-group">
                        <label class="form-label">Name</label>
                        <input readonly="" type="text" value="[[name]]" class="form-input" />
                    </div>
                    <!-- Email -->
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input readonly="" type="email" value="[[email]]" class="form-input" />
                    </div>
                    <!-- Company Name -->
                    <div class="form-group">
                        <label class="form-label">Company Name</label>
                        <input readonly="" type="text" value="[[company_name]]" class="form-input" />
                    </div>
                    <!-- Address -->
                    <div class="form-group">
                        <label class="form-label">Address</label>
                        <input readonly="" type="text" value="[[address]]" class="form-input" />
                    </div>
                </div>
            </div>
            <!-- Instances Section (New) -->
            <div id="instances-section" class="card-section">
                <h2 class="card-title">Instances
                </h2>
                <div id="instances-container">
                    <!-- Loader -->
                    <div id="id9cv">
                        <span id="iza0a" class="material-icons">refresh</span>
                    </div>
                </div>
            </div>
        </div>
        <!-- Management Tab -->
        <div id="management-tab" class="tab-content">
            <div class="management-grid">
                <!--View Plan Card-->
                <div class="card-section">
                    <h2 class="card-title">View Your Plan
                    </h2>
                    <p class="card-subtitle">
                        Review your current subscription plan, including its features, limits, and renewal date. See
                        what's included in your tier and explore available upgrade options to access more advanced tools
                        and higher storage capacity.
                    </p>
                    <div id="ivxi3">
                        <a href="/page/plan-details/[[id]]" class="btn-upgrade"><span
                                class="material-icons">list_alt</span> View Your Plan</a>
                    </div>
                </div>
                <!-- Upgrade Account Card -->
                <div class="card-section">
                    <h2 class="card-title">Upgrade Your Account
                    </h2>
                    <p class="card-subtitle">
                        Unlock premium features and enhanced capabilities by upgrading your account.
                        Get access to advanced tools, increased storage, and priority support to maximize your
                        productivity.
                    </p>
                    <div id="iobgt">
                        <a href="/page/order-summary/[[id]]" class="btn-upgrade"><span
                                class="material-icons">workspace_premium</span> Upgrade Your Account</a>
                    </div>
                </div>
                <!-- Freeze Account Card -->
                <div class="card-section">
                    <h2 class="card-title">Freeze Your Account
                    </h2>
                    <p class="card-subtitle">
                        Paid plans can freeze their account for a reduced fee and activate it later.
                        Apps and data cannot be accessed while the account is frozen. An account can be frozen once per
                        year.
                    </p>
                    <div id="ilhnk">
                        <button id="triggerFreezeModal" class="btn-danger-soft"><span
                                class="material-icons">ac_unit</span> Freeze Your
                            Account</button>
                        <!--<span class="available-badge">Available on paid plans only</span>-->
                    </div>
                </div>
                <!-- Cancel/Delete Card -->
                <div class="card-section">
                    <h2 class="card-title">Cancel Subscription / Delete Account
                    </h2>
                    <p class="card-subtitle">
                        Canceling your subscription / Deleting your account will lead to an immediate removal of this
                        account.
                        All apps and data will be deleted and cannot be restored. We recommend exporting your data prior
                        to deleting your account.
                    </p>
                    <div id="i3s5nz">
                        <button id="triggerDeleteModal" class="btn-danger"><span
                                class="material-icons">delete_forever</span> Cancel Subscription / Delete
                            Account</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Products Tab-->
        <div id="products-tab" class="tab-content">
            <div class="card-section">
                <div class="card-header">
                    <h2 class="card-title">My Products
                    </h2>
                    <button id="addNewProductTrigger" class="tab-action-btn"><span class="material-icons">add</span> Add
                        New Product
                    </button>
                </div>
                <div id="products-container">
                    <!-- Loader -->
                    <div id="i5gaiw">
                        <span id="ij24rn" class="material-icons">refresh</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        (function () {
            // styles for loader
            const style = document.createElement("style");
            style.id = "loader-style";
            style.innerHTML = `
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      backdrop-filter: blur(8px);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      z-index: 9999;
    }

    .overlay.active {
      opacity: 1;
      visibility: visible;
      background-color: rgb(240 246 255 / 59%) !important;
    }

    .loader-keystone {
      width: 36px;   /* smaller loader */
      overflow: visible;
      transform: rotate(-90deg);
      transform-origin: center;
      --active: rgb(37 99 235);
      --track: rgb(187 217 255);
      --duration: 8s;
      animation: spin 2s linear infinite;
    }

    @keyframes spin {
      0% { rotate: 0deg; }
      100% { rotate: 360deg; }
    }

    .active {
      stroke: var(--active);
      stroke-linecap: round;
      stroke-dashoffset: 360;
      animation: active-animation var(--duration) ease-in-out infinite;
    }

    @keyframes active-animation {
      0% { stroke-dasharray: 0 0 0 360 0 360; }
      12.5% { stroke-dasharray: 0 0 270 90 270 90; }
      25% { stroke-dasharray: 0 270 0 360 0 360; }
      37.5% { stroke-dasharray: 0 270 270 90 270 90; }
      50% { stroke-dasharray: 0 540 0 360 0 360; }
      50.001% { stroke-dasharray: 0 180 0 360 0 360; }
      62.5% { stroke-dasharray: 0 180 270 90 270 90; }
      75% { stroke-dasharray: 0 450 0 360 0 360; }
      87.5% { stroke-dasharray: 0 450 270 90 270 90; }
      87.501% { stroke-dasharray: 0 90 270 90 270 90; }
      100% { stroke-dasharray: 0 360 1 360 0 360; }
    }

    .track {
      stroke: var(--track);
      stroke-linecap: round;
      stroke-dashoffset: 360;
      animation: track-animation var(--duration) ease-in-out infinite;
    }

    @keyframes track-animation {
      0% { stroke-dasharray: 0 20 320 40 320 40; }
      12.5% { stroke-dasharray: 0 290 50 310 50 310; }
      25% { stroke-dasharray: 0 290 320 40 320 40; }
      37.5% { stroke-dasharray: 0 560 50 310 50 310; }
      37.501% { stroke-dasharray: 0 200 50 310 50 310; }
      50% { stroke-dasharray: 0 200 320 40 320 40; }
      62.5% { stroke-dasharray: 0 470 50 310 50 310; }
      62.501% { stroke-dasharray: 0 110 50 310 50 310; }
      75% { stroke-dasharray: 0 110 320 40 320 40; }
      87.5% { stroke-dasharray: 0 380 50 310 50 310; }
      100% { stroke-dasharray: 0 380 320 40 320 40; }
    }
  `;
            document.head.appendChild(style);

            // Create overlay
            const overlay = document.createElement("div");
            overlay.className = "overlay active";
            overlay.id = "loader-overlay";

            // Create SVG loader
            overlay.innerHTML = `
    <svg class="loader-keystone" viewBox="0 0 120 120">
      <circle class="track" cx="60" cy="60" r="54" fill="none" stroke-width="12"/>
      <circle class="active" cx="60" cy="60" r="54" fill="none" stroke-width="12"/>
    </svg>
  `;
            document.body.appendChild(overlay);

            function checkTenant() {
                const tenantInput = document.getElementById('tenant-id');
                const tenantId = tenantInput ? tenantInput.value : null;

                if (tenantId && tenantId !== "[[id]]" && tenantId.trim() !== "") {
                    // Valid ID, show content
                    overlay.remove();
                    style.remove();
                    const container = document.querySelector('.main-container');
                    if (container) container.classList.remove('d-none');
                } else {
                    // Invalid ID, fetch and redirect
                    csrfFetch("/preview-expression", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            expression_field: "invalid_error",
                            field_id: "644205d9-d4d0-4fd4-8604-81a1c0d89cce",
                            fields: {}
                        })
                    })
                        .then(res => res.json())
                        .then(data => {
                            let fetchedId = data.result;
                            if (fetchedId && fetchedId !== "null" && fetchedId !== "") {
                                const currentUrl = new URL(window.location.href);
                                let pathname = currentUrl.pathname.replace(/\/$/, "");
                                currentUrl.pathname = `${pathname}/${fetchedId}`;
                                window.location.href = currentUrl.toString();
                            } else {
                                // Result is null or empty - Show Modal
                                if (overlay) overlay.remove();
                                if (style) style.remove();

                                const noTenantModalHtml = `
                        <div class="custom-modal-overlay open" id="noTenantModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); display: flex; justify-content: center; align-items: center; z-index: 10000; backdrop-filter: blur(2px);">
                            <div class="custom-modal" style="background-color: white; border-radius: 12px; width: 100%; max-width: 450px; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 24px 38px 3px rgba(0,0,0,0.14), 0 9px 46px 8px rgba(0,0,0,0.12), 0 11px 15px -7px rgba(0,0,0,0.2);">
                                <div class="modal-header" style="padding: 32px 32px 12px; display: flex; justify-content: center; border-bottom: none;">
                                    <div style="background-color: #fce8e6; width: 64px; height: 64px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                        <span class="material-icons" style="color: #d93025; font-size: 36px;">error_outline</span>
                                    </div>
                                </div>
                                <div class="modal-body" style="padding: 0 32px 24px; text-align: center;">
                                    <h3 style="margin: 0 0 12px; font-size: 1.5rem; font-weight: 700; color: #202124; font-family: 'Roboto', sans-serif;">Account Not Found</h3>
                                    <p style="margin: 0; font-size: 0.95rem; color: #5f6368; line-height: 1.6; font-family: 'Roboto', sans-serif;">It looks like your tenant account doesn't exist in our system. You need to create a new one to continue.</p>
                                </div>
                                <div class="modal-footer" style="padding: 0 32px 32px; display: flex; justify-content: center; gap: 16px; border-top: none;">
                                    <button id="noTenantCancelBtn" style="min-width: 120px; padding: 10px 24px; border: 1px solid #dadce0; border-radius: 8px; background: white; cursor: pointer; font-weight: 500; font-family: 'Roboto', sans-serif; color: #3c4043; transition: all 0.2s;">Cancel</button>
                                    <button id="noTenantOkBtn" style="min-width: 120px; padding: 10px 24px; border: none; border-radius: 8px; background-color: #1a73e8; color: white; cursor: pointer; font-weight: 500; font-family: 'Roboto', sans-serif; transition: all 0.2s;">Create New</button>
                                </div>
                            </div>
                        </div>
                    `;
                                document.body.insertAdjacentHTML('beforeend', noTenantModalHtml);

                                document.getElementById('noTenantCancelBtn').onclick = () => {
                                    document.getElementById('noTenantModal').remove();
                                };

                                document.getElementById('noTenantOkBtn').onclick = () => {
                                    window.location.href = "https://snapapp.com/page/snapapp-registration?app=d2f43416-bfe5-49b8-a679-25f6e3d2710a";
                                };
                            }
                        })
                        .catch(err => console.error("Error fetching ID:", err));
                }
            }

            // Check immediately
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', checkTenant);
            } else {
                checkTenant();
            }
        })();

        // Tab Logic
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                // Remove active class from all
                tabButtons.forEach(b => b.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));
                // Add active to current
                button.classList.add('active');
                const targetId = button.getAttribute('data-tab') + '-tab';
                const targetContent = document.getElementById(targetId);
                if (targetContent) {
                    targetContent.classList.add('active');
                }
            }
            );
        }
        );
        // Modal Implementation
        document.addEventListener('DOMContentLoaded', () => {
            // styles for modal
            const modalStyles = `
.custom-modal-overlay {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-color: rgba(0, 0, 0, 0.5);
display: flex;
justify-content: center;
align-items: center;
z-index: 1000;
opacity: 0;
visibility: hidden;
transition: all 0.3s ease;
backdrop-filter: blur(2px);
}
.custom-modal-overlay.open {
opacity: 1;
visibility: visible;
}
.custom-modal {
background-color: white;
border-radius: 8px;
width: 100%;
margin-top: 40px !important;
max-width: 650px;
max-height: 90vh; /* Allow scrolling if screen is short */
overflow-y: auto;
display: flex;
flex-direction: column;
transform: translateY(20px);
transition: transform 0.3s ease;
position: relative;
}
.custom-modal-overlay.open .custom-modal {
transform: translateY(0);
}
.modal-header {
padding: 24px 32px;
padding-bottom: 12px !important;
display: flex;
justify-content: space-between;
align-items: flex-start;
border-bottom: 0px !important;
}
.modal-title {
font-size: 1.25rem;
font-weight: 700;
color: #202124;
margin: 0;
}
.close-modal-btn {
position: absolute;
top: 24px;
right: 24px;
cursor: pointer;
color: #5f6368;
font-size: 24px;
padding: 4px;
border-radius: 50%;
transition:  background-color 0.2s;
line-height: 1;
}
.close-modal-btn:hover {
background-color: #f1f3f4;
}
.modal-body {
padding: 0 32px 0px 32px;
overflow-y: auto;
}
.modal-subtitle {
font-size: 0.95rem;
color: #5f6368;
margin-bottom: 24px;
}
.option-box {
margin-bottom: 20px;
}
.option-title {
font-size: 1rem;
font-weight: 500;
color: #3c4043;
margin-bottom: 8px;
}
.option-desc {
font-size: 0.9rem;
color: #3c4043;
line-height: 1.5;
margin-bottom: 16px;
}
.option-action {
display: flex;
align-items: center;
gap: 12px;
}
.btn-freeze-modal {
background-color: rgb(219, 233, 254) !important;
color: rgb(29, 64, 176) !important;
border: none;
padding: 10px 12px;
border-radius: 8px;
font-weight: 600;
font-size: 0.9rem;
cursor: pointer;
transition: background-color 0.2s;
}
.btn-freeze-modal:hover {
background-color: rgb(219, 233, 254) !important;
color: rgb(29, 64, 176) !important;
}
.btn-freeze-modal:focus{
outline: none !important;
}
.price-text {
color: #5f6368;
font-size: 0.9rem;
}
.reasons-section {
margin-bottom: 0px !important;
}
.reason-label {
display: block;
font-size: 0.95rem;
font-weight: 500;
color: #3c4043;
margin-bottom: 16px;
}
.radio-group {
display: flex;
flex-direction: column;
gap: 1px !important;
}
.radio-option {
display: flex;
align-items: center;
gap: 10px;
font-size: 0.9rem;
color: #3c4043;
cursor: pointer;
}
.radio-option input[type="radio"] {
accent-color: #1976d2; /* Or matching pink if desired, lets stick to standard blue or pink */
width: 18px;
height: 18px;
margin: 0;
cursor: pointer;
}
.required {
color: #d93025;
margin-left: 2px;
}
/* Warning */
.warning-section {
margin-bottom: 16px;
}
.warning-title {
font-size: 0.95rem;
color: #3c4043;
margin-bottom: 4px;
}
.warning-text {
font-size: 0.9rem;
color: #5f6368;
line-height: 1.5;
}
/* Footer */
.modal-footer {
padding: 16px 32px 16px 32px;
display: flex;
justify-content: flex-end;
gap: 8px;
border-top: none; 
}
.btn-cancel-ghost {
background: transparent;
border: 1px solid #dadce0;
color: #3c4043;
padding: 10px 12px;
border-radius: 8px;
font-weight: 500;
cursor: pointer;
transition: all 0.2s;
}
.btn-cancel-ghost:hover {
background-color: #f1f3f4;
border-color: #cfd2d6;
}
.btn-delete-final {
background-color: rgb(254, 219, 219) !important;
color: rgb(176, 29, 29) !important;
border: none;
padding: 10px 12px;
border-radius: 8px;
font-size: 0.9rem;
font-weight: 500;
cursor: pointer;
transition: background-color 0.2s;
}
.btn-delete-final:hover {
background-color: rgb(254, 219, 219) !important;
color: rgb(176, 29, 29) !important;
}
.btn-delete-final:focus{
outline: none !important;
}
.btn-delete-final:disabled {
background-color: #e0e0e0 !important;
color: #9e9e9e !important;
cursor: not-allowed;
pointer-events: none;
}
/* Product Type Selection Modal Styles */
.product-type-grid {
display: grid;
grid-template-columns: repeat(2, 1fr);
gap: 20px;
margin-top: 10px;
margin-bottom: 20px;
}
.product-type-card {
background: white;
border: 1px solid #e8eaed;
border-radius: 12px;
padding: 30px 20px;
padding-bottom: 25px !important;
display: flex;
flex-direction: column;
align-items: center;
text-align: center;
cursor: pointer;
transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}
.product-type-card:hover {
border-color: #1a73e8;
background-color: #f8fbff;
transform: translateY(-2px);
box-shadow: 0 4px 12px rgba(0,0,0,0.06);
}
.type-icon-box {
width: 56px;
height: 56px;
border-radius: 12px;
display: flex;
align-items: center;
justify-content: center;
margin-bottom: 20px;
}
.type-icon-box .material-icons {
font-size: 28px;
}
.bg-blue-soft { background-color: #e8f0fe; color: #1565c0; }
.bg-purple-soft { background-color: #f3e8fd; color: #7b1fa2; }
.type-title {
font-size: 1.15rem;
font-weight: 600;
color: #202124;
margin-bottom: 8px;
}
.type-desc {
font-size: 0.9rem;
color: #5f6368;
line-height: 1.5;
margin-bottom: 0px !important;
}

/* Upgrade Feature Modal Styles */
.sku-list {
margin-top: 12px;
display: flex;
flex-direction: column;
gap: 12px;
}
.sku-item {
display: flex;
justify-content: space-between;
align-items: center;
padding: 16px;
border: 1px solid #e8eaed;
border-radius: 8px;
background: #f8f9fa;
transition: all 0.2s ease;
}
.sku-item:hover {
background: #f1f3f4;
border-color: #dadce0;
}
.sku-info {
flex: 1;
}
.sku-name {
font-weight: 500;
color: #202124;
font-size: 0.95rem;
margin-bottom: 2px;
}
.sku-price {
font-size: 0.85rem;
color: #5f6368;
}
.sku-control {
margin-left: 16px;
min-width: 140px;
display: flex;
justify-content: flex-end;
}
.sku-select {
width: 100%;
padding: 8px 10px;
border: 1px solid #dadce0;
border-radius: 6px;
font-size: 0.9rem;
background: white;
color: #3c4043;
outline: none;
transition: border-color 0.2s;
}
/* Quantity Selector Styles */
.qty-selector {
display: flex;
align-items: center;
gap: 16px;
background: transparent;
}
.qty-btn {
width: 32px;
height: 32px;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
transition: all 0.2s;
padding: 0;
background: white;
}
.qty-minus {
border: 1.5px solid #1a73e8 !important;
color: #1a73e8 !important;
}
.qty-minus:hover:not(:disabled) {
border-color: #1a73e8 !important;
color: #1a73e8 !important;
}
.qty-plus {
border: 1.5px solid #1a73e8;
color: #1a73e8;
}
.qty-plus:hover {
background-color: #f8fbff;
}
.qty-btn:disabled {
border-color: #e8eaed !important;
color: #e8eaed !important;
cursor: not-allowed;
}
.qty-btn .material-icons {
font-size: 20px;
font-weight: 500;
}
.qty-value {
font-size: 1.1rem;
font-weight: 700;
color: #202124;
min-width: 14px;
text-align: center;
}
.sku-group-label {
font-size: 0.8rem;
font-weight: 700;
color: #5f6368;
text-transform: uppercase;
letter-spacing: 0.8px;
margin-top: 20px;
margin-bottom: 8px;
display: flex;
align-items: center;
gap: 6px;
}
.sku-group-label .material-icons {
font-size: 16px;
}
.sku-loader {
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
padding: 40px;
gap: 12px;
color: #5f6368;
}
.sku-loader .material-icons {
animation: spin 1s linear infinite;
font-size: 32px;
color: #1a73e8;
}

/* Toast Styles */
.toast-container {
position: fixed;
top: 32px;
right: 24px;
background-color: #1a73e8;
color: white;
padding: 12px 24px;
border-radius: 8px;
font-size: 0.95rem;
z-index: 3000;
display: flex;
align-items: center;
gap: 12px;
opacity: 0;
visibility: hidden;
transform: translateX(20px);
transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
.toast-container.show {
opacity: 1;
visibility: visible;
transform: translateX(0);
}
.toast-icon {
color: white;
font-size: 20px;
}

/* Freeze Modal Styles */
@keyframes freeze-spin {
  0% { transform: rotate(0deg) scale(1); }
  30% { transform: rotate(15deg) scale(1.08); }
  60% { transform: rotate(-10deg) scale(1.04); }
  100% { transform: rotate(0deg) scale(1); }
}
#freezeContinueBtn:hover {
  background: linear-gradient(135deg, #0d47a1 0%, #1565c0 100%) !important;
  transform: translateY(-1px);
}
#freezeContinueBtn:focus { outline: none; }
#freezeContinueBtn:disabled {
  background: #b0bec5 !important;
  color: #eceff1 !important;
  cursor: not-allowed;
  box-shadow: none !important;
  transform: none !important;
}
/* Freeze button — already-frozen disabled state with tooltip */
.freeze-btn-disabled-wrap {
  position: relative;
  display: inline-block;
}
.freeze-btn-disabled-wrap .freeze-tooltip {
  visibility: hidden;
  opacity: 0;
  pointer-events: none;
  position: absolute;
  bottom: calc(100% + 8px);
  left: 50%;
  transform: translateX(-50%);
  background: #1565c0;
  color: #fff;
  font-size: 0.78rem;
  font-weight: 500;
  white-space: nowrap;
  padding: 6px 12px;
  border-radius: 8px;
  box-shadow: 0 2px 10px rgba(21,101,192,0.22);
  transition: opacity 0.18s ease, visibility 0.18s ease;
  z-index: 9000;
  font-family: 'Roboto', sans-serif;
}
.freeze-btn-disabled-wrap .freeze-tooltip::after {
  content: '';
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  border: 6px solid transparent;
  border-top-color: #1565c0;
}
.freeze-btn-disabled-wrap:hover .freeze-tooltip {
  visibility: visible;
  opacity: 1;
}
/* Cart Modal Styles */
.cart-summary-list {
display: flex;
flex-direction: column;
gap: 16px;
margin-top: 16px;
}
.cart-item {
display: flex;
justify-content: space-between;
align-items: flex-start;
padding-bottom: 16px;
border-bottom: 1px solid #f1f3f4;
}
.cart-item-info {
flex: 1;
}
.cart-item-name {
font-weight: 500;
color: #202124;
margin-bottom: 4px;
}
.cart-item-details {
font-size: 0.85rem;
color: #5f6368;
}
.cart-item-price {
font-weight: 600;
color: #202124;
margin-left: 16px;
}
.cart-total-section {
margin-top: 24px;
padding-top: 16px;
border-top: 2px solid #f1f3f4;
}
.cart-total-row {
display: flex;
justify-content: space-between;
margin-bottom: 12px;
}
.cart-total-label {
color: #5f6368;
font-weight: 500;
}
.cart-total-value {
font-weight: 700;
font-size: 1.25rem;
color: #1a73e8;
}
.cart-empty {
text-align: center;
padding: 40px 0;
color: #5f6368;
}
.cart-empty .material-icons {
font-size: 48px;
color: #dadce0;
margin-bottom: 12px;
}
`;
            // Inject Styles
            const styleSheet = document.createElement("style");
            styleSheet.innerText = modalStyles + `
/* Instances Section */
#instances-section {
margin-top: 32px;
padding-top: 32px;
border-top: 1px solid #dadce0;
display: none; /* Hidden by default, shown by JS */
}
.section-title {
font-size: 1.25rem;
font-weight: 700;
color: #202124;
margin-bottom: 24px;
}
#instances-container {
display: grid;
gap: 20px;
}
.instance-card {
border: 1px solid #e0e0e0;
border-radius: 12px;
padding: 24px 28px;
margin-bottom: 20px;
display: flex;
justify-content: space-between;
align-items: center;
background-color: white;
transition: all 0.2s ease;
}
.instance-card-left {
display: flex;
flex-direction: column;
gap: 25px;
flex: 1;
}
.instance-card-right {
display: flex;
align-items: center;
margin-left: 24px;
}
.instance-open-btn {
display: inline-flex;
align-items: center;
justify-content: center;
padding: 10px 15px;
background-color: rgb(219, 233, 254) !important;
color: rgb(29, 64, 176) !important;
text-decoration: none;
border: 1px solid rgba(29, 63, 176, 0.133);
border-radius: 8px;
font-weight: 500;
font-size: 0.9rem;
transition: all 0.2s ease;
cursor: pointer;
gap: 6px;
height: 40px;
}
.instance-open-btn:hover {
background-color: rgb(191, 219, 254) !important;
color: rgb(29, 64, 176) !important;
/* transform: translateY(-1px); */
}
.instance-open-btn:focus {
outline: none !important;
}
@media (max-width: 900px) {
.instance-card {
flex-direction: column;
align-items: flex-start;
gap: 20px;
padding: 20px;
}
.instance-card-right {
width: 100%;
margin-left: 0;
}
.instance-open-btn {
width: 100%;
}
.instance-metrics {
width: 100%;
grid-template-columns: repeat(2, 1fr);
gap: 20px 30px;
}
}
@media (max-width: 600px) {
.instance-card {
padding: 16px;
gap: 16px;
}
.instance-metrics {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 16px;
}
.metric-group {
gap: 10px;
}
.ring-chart {
width: 32px;
height: 32px;
}
.metric-text {
font-size: 0.85rem;
white-space: normal;
line-height: 1.2;
}
}
@media (max-width: 400px) {
.instance-metrics {
grid-template-columns: 1fr;
}
}
.instance-info {
display: flex;
align-items: center;
gap: 12px;
flex-wrap: wrap;
flex: 1;
}
.instance-info h3 {
font-size: 1.1rem;
font-weight: 600;
color: #1a1a1a;
margin: 0;
word-break: break-all;
}
/* Status Badge Styles */
.status-badge {
display: inline-flex;
align-items: center;
gap: 6px;
padding: 4px 10px;
border-radius: 16px;
font-size: 0.8rem;
font-weight: 600;
white-space: nowrap;
}
.status-badge .material-icons {
font-size: 16px;
}
.status-active {
background-color: #d0fae5;
color: #006145;
}
.status-suspended {
background-color: #ffedd4;
color: #a02d00;
}
/* Trial Badge Styles */
.trial-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    border-radius: 8px;
    font-size: 0.85rem;
    font-weight: 500;
    transition: all 0.2s ease;
    border: 1px solid transparent;
}
.trial-badge-active {
    background-color: #fff8e1;
    color: #ff8f00;
    border-color: #ffecb3;
}
.trial-badge-expired {
    background-color: #fff3e0;
    color: #e65100;
    border-color: #ffe0b2;
}
.trial-badge .material-icons {
    font-size: 18px;
}
.trial-badge .upgrade-link {
    color: #1a73e8 !important;
    text-decoration: none !important;
    margin-left: 4px;
    font-weight: 700;
}
.trial-badge .upgrade-link:hover {
    text-decoration: underline !important;
}
.status-deleted {
background-color: #fee4e6;
color: #a50036;
}
.instance-metrics {
display: grid;
grid-template-columns: repeat(4, 1fr);
gap: 24px 30px;
align-items: center;
margin-top: 5px;
}
@media (max-width: 1200px) {
.instance-metrics {
grid-template-columns: repeat(3, 1fr);
}
}
@media (max-width: 900px) {
.instance-metrics {
grid-template-columns: repeat(2, 1fr);
}
}
@media (max-width: 500px) {
.instance-metrics {
grid-template-columns: 1fr;
}
}
.metric-group {
display: flex;
align-items: center;
gap: 14px;
}
.metric-text {
font-size: 0.9rem;
color: #5f6368;
font-weight: 500;
white-space: nowrap;
}
/* Ring Chart CSS */
.ring-chart {
position: relative;
width: 42px; /* Size of the chart */
height: 42px;
}
.circular-chart {
display: block;
margin: 0 auto;
max-width: 100%;
max-height: 100%;
}
.circle-bg {
fill: none;
stroke: #eee;
stroke-width: 4.8;
}
.circle {
fill: none;
stroke-width: 4.8;
stroke-linecap: round;
stroke: #1a73e8;
transform-origin: center;
transition: stroke-dasharray .3s ease-out;
}
/* Specific colors for each metric type */
.circle-seats { stroke: #1976d2; } /* Seats/Users - Blue */
.circle-objects { stroke: #34a853; } /* Objects - Green */
.circle-records { stroke: #f9ab00; } /* Records - Orange/Yellow */
.circle-workflow { stroke: #9c27b0; } /* Workflow - Purple */
.circle-storage { stroke: #00bcd4; } /* Storage - Cyan */
.circle-emails { stroke: #ea4335; } /* Emails - Red */
.circle-sms { stroke: #ff4081; } /* SMS - Pink */
/* Empty State */
.empty-state {
text-align: center;
padding: 40px 20px;
color: #5f6368;
border: 1px dashed #dadce0;
border-radius: 8px;
}
.empty-state-icon {
font-size: 48px;
margin-bottom: 10px;
color: #9aa0a6;
}
.empty-state-text {
font-size: 1rem;
margin: 0;
}
@keyframes spin {
100% { -webkit-transform: rotate(360deg); transform:rotate(360deg); }
}
/* Product Cards Styles */
#products-container {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
gap: 24px;
margin-top: 24px;
}
#products-container .empty-state {
grid-column: 1 / -1;
}
.product-card {
background: white;
border: 1px solid #dcdaf5;
border-radius: 16px;
overflow: hidden;
transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
display: flex;
flex-direction: column;
}
.product-card:hover {
transform: translateY(-4px);
border-color: #1976d2;
}
.product-image-container {
width: 100%;
height: 200px;
overflow: hidden;
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
position: relative;
}
.product-image {
width: 100% !important;
height: 100% !important;
object-fit: cover !important;
transition: transform 0.3s ease !important;
display: block !important;
border: none !important;
}
.product-card:hover .product-image {
transform: scale(1.05) !important;
}
.product-content {
padding: 20px;
flex: 1;
display: flex;
flex-direction: column;
}
.product-title {
font-size: 1.15rem;
font-weight: 600;
color: #202124;
margin: 0 0 8px 0;
line-height: 1.3;
}
.product-subtitle {
font-size: 0.9rem;
color: #5f6368;
margin: 0;
line-height: 1.5;
flex: 1;
}
@media (max-width: 768px) {
#products-container {
grid-template-columns: 1fr;
}
}
@media (min-width: 769px) and (max-width: 1024px) {
#products-container {
grid-template-columns: repeat(2, 1fr);
}
}
@media (min-width: 1025px) {
#products-container {
grid-template-columns: repeat(3, 1fr);
}
}
.product-footer {
padding: 16px 20px;
display: flex;
justify-content: flex-end;
border-top: 1px solid #f1f3f4;
}
.product-btn {
padding: 10px 14px;
border: 1px solid #dcdaf5;
border-radius: 10px;
background: white;
color: #3c4043;
font-size: 0.9rem;
font-weight: 500;
cursor: pointer;
transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
text-decoration: none;
display: inline-flex;
align-items: center;
justify-content: center;
}
.product-btn:hover {
background-color: #f8f1f6;
border-color: #22182B;
transform: translateY(-1px);
}
.product-btn:focus{
outline: none !important;
}
.product-btn:active {
background-color: #f1f3f4;
transform: translateY(0);
}
`;
            document.head.appendChild(styleSheet);
            // Create Modal HTML
            const modalHtml = `
<div class="custom-modal-overlay" id="deleteAccountModal">
<div class="custom-modal">
<div class="modal-header">
<h3 class="modal-title">Cancel Subscription / Delete Account</h3>
<span class="material-icons close-modal-btn" id="closeModalIcon">close</span>
    </div>
<div class="modal-body">
<p class="modal-subtitle">Before you delete, please consider these options:</p>
<div class="option-box">
<div class="option-title">Option 1: Freeze your account</div>
<p class="option-desc">If you need to put your app on hold but don't want to lose all your data, you can freeze it. You won't be able to use your app while it's frozen, but you can unfreeze it at any time to restore your apps.</p>
<div class="option-action">
<button class="btn-freeze-modal" id="btnFreezeModalInner">Freeze Your Account</button>
    </div>
    </div>
<div class="reasons-section">
<label class="reason-label">What's your main reason for leaving? <span class="required">*</span></label>
<div class="radio-group">
<label class="radio-option"><input type="radio" name="leave_reason" value="price"> Price</label>
<label class="radio-option"><input type="radio" name="leave_reason" value="support_issue"> Issue with support</label>
<label class="radio-option"><input type="radio" name="leave_reason" value="job_change"> Job change/Left company</label>
<label class="radio-option"><input type="radio" name="leave_reason" value="not_fit"> Not a good fit for us</label>
<label class="radio-option"><input type="radio" name="leave_reason" value="product_issue"> Issue with product</label>
<label class="radio-option"><input type="radio" name="leave_reason" value="other"> Other</label>
    </div>
    </div>
    </div>
<div class="modal-footer">
<button class="btn-cancel-ghost" id="modalCancelBtn">Cancel</button>
<button class="btn-delete-final" id="confirmDeleteBtn" disabled>Cancel Subscription / Delete Account</button>
    </div>
    </div>
    </div>
<div class="custom-modal-overlay" id="addProductModal">
<div class="custom-modal" style="max-width: 700px;">
<span class="material-icons close-modal-btn" id="closeAddProductIcon">close</span>
<div class="modal-header" style="padding-bottom: 8px;">
<h3 class="modal-title" style="font-size: 1.5rem;">Choose Product Type</h3>
    </div>
<div class="modal-body">
<p class="modal-subtitle" style="margin-bottom: 32px;">Select the type of product you want to add to your account.</p>
<div class="product-type-grid" style="grid-template-columns: repeat(2, 1fr); gap: 24px; margin-bottom: 32px;">
<div class="product-type-card" id="newEnvBtn">
<div class="type-icon-box bg-blue-soft" style="width: 64px; height: 64px; border-radius: 12px; margin-bottom: 24px;">
<span class="material-icons" style="font-size: 32px;">lan</span>
    </div>
<div class="type-title" style="font-size: 1.25rem; font-weight: 700; margin-bottom: 12px;">Add New Environment</div>
<p class="type-desc" style="font-size: 0.95rem; color: #666; line-height: 1.6;">Create a fresh, isolated workspace for your apps and services.</p>
    </div>
<div class="product-type-card" id="newSolutionBtn">
<div class="type-icon-box bg-purple-soft" style="width: 64px; height: 64px; border-radius: 12px; margin-bottom: 24px;">
<span class="material-icons" style="font-size: 32px;">inventory_2</span>
    </div>
<div class="type-title" style="font-size: 1.25rem; font-weight: 700; margin-bottom: 12px;">Add New Solution</div>
<p class="type-desc" style="font-size: 0.95rem; color: #666; line-height: 1.6;">Browse and add pre-built solutions from our product catalog.</p>
    </div>
    </div>
    </div>
    </div>
    </div>

<div class="custom-modal-overlay" id="upgradeFeatureModal">
<div class="custom-modal">
<div class="modal-header">
<h3 class="modal-title">Upgrade Features</h3>
<span class="material-icons close-modal-btn" id="closeUpgradeModalIcon">close</span>
    </div>
<div class="modal-body">
<p class="modal-subtitle" style="margin-bottom: 16px;">Select additional capacity or higher tiers to enhance your product.</p>
<div id="sku-container">
<!-- SKUs will be injected here -->
    </div>
    </div>
<div class="modal-footer">
<button class="btn-cancel-ghost" id="upgradeCancelBtn">Cancel</button>
<button class="btn-delete-final" id="upgradeConfirmBtn" style="background-color: #1062FE !important; color: white !important;">Add to Cart</button>
    </div>
    </div>
    </div>

<div class="custom-modal-overlay" id="cartModal">
<div class="custom-modal">
<div class="modal-header">
<h3 class="modal-title">Order Summary</h3>
<span class="material-icons close-modal-btn" id="closeCartModalIcon">close</span>
    </div>
<div class="modal-body">
<div id="cart-content">
<!-- Cart items will be injected here -->
    </div>
    </div>
<div class="modal-footer">
<button class="btn-cancel-ghost" id="cartCancelBtn">Cancel</button>
<button class="btn-delete-final" id="checkoutBtn" style="background-color: #1062FE !important; color: white !important;">Checkout</button>
    </div>
    </div>
    </div>

<div id="cartToast" class="toast-container">
<span class="material-icons toast-icon">check_circle</span>
<span id="toastMessage">Items are added in the cart!</span>
</div>

<div class="custom-modal-overlay" id="cautionDeleteModal" style="z-index: 2000;">
<div class="custom-modal" style="max-width: 480px; border-radius: 16px;">
<div class="modal-header" style="justify-content: center; position: relative; padding: 32px 24px 16px 24px;">
<h3 class="modal-title" style="text-transform: uppercase; width: 100%; text-align: center; letter-spacing: 1.5px; font-weight: 800; font-size: 1.1rem; color: #3c4043;"></h3>
<span class="material-icons close-modal-btn" id="closeCautionModalIcon">close</span>
</div>
<div class="modal-body" style="text-align: center; padding: 0 40px 24px 40px;">
<div style="background-color: #fff8e1; width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px auto;">
<span class="material-icons" style="font-size: 48px; color: #f4b400;">warning</span>
</div>
<p class="modal-subtitle" style="line-height: 1.6; color: #5f6368; font-size: 1rem; margin-bottom: 0;">This action will delete your SnapApp environment and your tenant account. <br><strong>Do you wish to continue?</strong></p>
</div>
<div class="modal-footer" style="justify-content: center; padding: 0 30px 30px 30px; gap: 16px; border-top: none;">
<button class="btn-cancel-ghost" id="cautionNoBtn" style="min-width: 140px; height: 48px; border-radius: 12px; font-weight: 600;">No</button>
<button class="btn-delete-final" id="cautionYesBtn" style="background-color: rgb(254, 219, 219) !important; color: rgb(176, 29, 29) !important; min-width: 140px; height: 48px; border-radius: 12px; font-weight: 600; font-size: 1rem;">Continue</button>
</div>
</div>
</div>

<div class="custom-modal-overlay" id="cautionFreezeModal" style="z-index: 2100;">
<div class="custom-modal" style="max-width: 480px; border-radius: 16px;">
<div class="modal-header" style="justify-content: center; position: relative; padding: 32px 24px 16px 24px;">
<h3 class="modal-title" style="text-transform: uppercase; width: 100%; text-align: center; letter-spacing: 1.5px; font-weight: 800; font-size: 1.1rem; color: #1565c0;"></h3>
<span class="material-icons close-modal-btn" id="closeFreezeModalIcon" style="color: #5f6368;">close</span>
</div>
<div class="modal-body" style="text-align: center; padding: 0 40px 24px 40px;">
<div style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); width: 88px; height: 88px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px auto;">
<span class="material-icons freeze-icon-animate" style="font-size: 50px; color: #1565c0;">ac_unit</span>
</div>
<h3 style="margin: 0 0 10px; font-size: 1.25rem; font-weight: 700; color: #1565c0;">Freeze Your SnapApp Environment</h3>
<p class="modal-subtitle" style="line-height: 1.7; color: #455a64; font-size: 0.97rem; margin-bottom: 0;">Your SnapApp environment will be placed into a <strong>frozen state</strong>. Apps and data <strong>cannot be accessed</strong> while frozen, but your configuration and data are safely preserved. You can unfreeze at any time to restore full access.</span><br><br><strong style="color:#1565c0;">Do you wish to continue?</strong></p>
</div>
<div class="modal-footer" style="justify-content: center; padding: 0 30px 30px 30px; gap: 16px; border-top: none;">
<button class="btn-cancel-ghost" id="freezeNoBtn" style="min-width: 140px; height: 48px; border-radius: 12px; font-weight: 600;">Cancel</button>
<button id="freezeContinueBtn" style="min-width: 140px; height: 48px; border-radius: 12px; font-weight: 600; font-size: 0.97rem; background: linear-gradient(135deg, #1565c0 0%, #1976d2 100%); color: white; border: none; cursor: pointer; transition: all 0.2s;">Continue</button>
</div>
</div>
</div>

<div class="custom-modal-overlay" id="successDeleteModal" style="z-index: 3000;">
<div class="custom-modal" style="max-width: 480px; border-radius: 16px;">
<div class="modal-body" style="padding: 60px 40px; text-align: center;">
<div style="background-color: #e8f5e9; width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 24px auto;">
<span class="material-icons" style="font-size: 48px; color: #2e7d32;">check_circle</span>
</div>
<h3 class="modal-title" style="margin-bottom: 12px; font-size: 1.4rem; font-weight: 700; color: #202124;">Account Deleted Successfully</h3>
<p class="modal-subtitle" style="margin-bottom: 0; color: #5f6368; line-height: 1.6;">Your Tenant Account and Your SnapApp Environment has been deleted successfully. You will be redirected shortly.</p>
</div>
</div>
</div>
`;
            // Append Modal to Body
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            fetchInstances();

            // Event delegation for instances (to avoid CSP issues)
            const instancesContainer = document.getElementById('instances-container');
            if (instancesContainer) {
                instancesContainer.addEventListener('click', (e) => {
                    const btn = e.target.closest('.instance-open-btn');
                    if (btn) {
                        const domain = btn.getAttribute('data-domain');
                        if (domain) {
                            console.log('Button clicked for domain:', domain);
                            const url = `https://${domain}`;
                            console.log('Redirecting to:', url);
                            window.open(url, '_blank');
                        }
                    }
                });
            }
            // Delete Account Modal Logic
            const modal = document.getElementById('deleteAccountModal');
            const closeIcon = document.getElementById('closeModalIcon');
            const cancelBtn = document.getElementById('modalCancelBtn');
            const deleteTriggerBtn = document.getElementById('triggerDeleteModal');
            const confirmBtn = document.getElementById('confirmDeleteBtn');
            const reasonRadios = document.querySelectorAll('input[name="leave_reason"]');
            // Add Product Modal Logic
            const addProductModal = document.getElementById('addProductModal');
            const addProductTrigger = document.getElementById('addNewProductTrigger');
            const closeAddProductIcon = document.getElementById('closeAddProductIcon');
            const closeAddProductBtn = document.getElementById('closeAddProductBtn');
            const newSolutionBtn = document.getElementById('newSolutionBtn');
            const newEnvBtn = document.getElementById('newEnvBtn');
            function openModal() {
                modal.classList.add('open');
                document.body.style.overflow = 'hidden';
            }
            function closeModal() {
                modal.classList.remove('open');
                document.body.style.overflow = '';
                // Reset form
                reasonRadios.forEach(radio => radio.checked = false);
                confirmBtn.disabled = true;
            }
            if (deleteTriggerBtn) {
                deleteTriggerBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    openModal();
                }
                );
            }
            if (closeIcon) closeIcon.addEventListener('click', closeModal);
            if (cancelBtn) cancelBtn.addEventListener('click', closeModal);
            // Add Product Modal Listeners
            if (addProductTrigger) {
                addProductTrigger.addEventListener('click', () => {
                    addProductModal.classList.add('open');
                    document.body.style.overflow = 'hidden';
                }
                );
            }
            function closeAddProductModal() {
                addProductModal.classList.remove('open');
                document.body.style.overflow = '';
            }
            if (closeAddProductIcon) closeAddProductIcon.addEventListener('click', closeAddProductModal);
            if (closeAddProductBtn) closeAddProductBtn.addEventListener('click', closeAddProductModal);
            if (newSolutionBtn) {
                newSolutionBtn.addEventListener('click', () => {
                    window.location.href = "/page/snapapp-products?app=f82788c1-b9b2-48b6-81e4-e331ea2582f4";
                }
                );
            }
            if (newEnvBtn) {
                newEnvBtn.addEventListener('click', () => {
                    // alert('New Environment setup is currently handled by administrator.');
                    closeAddProductModal();
                }
                );
            }
            // Cart Logic and State (with Local Storage Persistence)
            const CART_STORAGE_KEY = 'snapapp_cart';
            let cart = {
                emailTier: null,
                addons: []
            };

            window.hasSubscribedProducts = false;

            // Load cart from Local Storage on initialization
            function loadCartFromStorage() {
                const savedCart = localStorage.getItem(CART_STORAGE_KEY);
                if (savedCart) {
                    try {
                        cart = JSON.parse(savedCart);
                        updateViewCartBtnVisibility();
                    } catch (e) {
                        console.error("Error parsing cart from storage", e);
                    }
                }
            }

            function saveCartToStorage() {
                localStorage.setItem(CART_STORAGE_KEY, JSON.stringify(cart));
                updateViewCartBtnVisibility();
            }

            window.updateViewCartBtnVisibility = function () {
                const btn = document.getElementById('viewCartBtn');
                if (btn) {
                    const hasItems = cart.emailTier || (cart.addons && cart.addons.length > 0);
                    const show = hasItems && window.hasSubscribedProducts;
                    btn.style.display = show ? 'inline-flex' : 'none';
                }
            }

            // Initial load
            loadCartFromStorage();

            const cartModal = document.getElementById('cartModal');
            const viewCartBtn = document.getElementById('viewCartBtn');
            const closeCartIcon = document.getElementById('closeCartModalIcon');
            const cartCancelBtn = document.getElementById('cartCancelBtn');
            const checkoutBtn = document.getElementById('checkoutBtn');
            const cartContent = document.getElementById('cart-content');

            function showToast(message) {
                const toast = document.getElementById('cartToast');
                const messageSpan = document.getElementById('toastMessage');
                if (message) messageSpan.innerText = message;
                toast.classList.add('show');
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 4000);
            }

            function openCartModal() {
                renderCart();
                cartModal.classList.add('open');
                document.body.style.overflow = 'hidden';
            }

            function closeCartModal() {
                cartModal.classList.remove('open');
                document.body.style.overflow = '';
            }

            function renderCart() {
                if (!cart.emailTier && (!cart.addons || cart.addons.length === 0)) {
                    cartContent.innerHTML = `
                  <div class="cart-empty">
                      <span class="material-icons">shopping_cart</span>
                      <p>Your cart is empty.</p>
                  </div>`;
                    return;
                }

                let subtotal = 0;
                let html = '<div class="cart-summary-list">';

                if (cart.emailTier) {
                    const price = parseFloat(cart.emailTier.price) || 0;
                    subtotal += price;
                    html += `
                  <div class="cart-item">
                      <div class="cart-item-info">
                          <div class="cart-item-name">${cart.emailTier.desc}</div>
                          <div class="cart-item-details">Email Tier Upgrade</div>
                      </div>
                      <div class="cart-item-price">$${price.toFixed(2)}</div>
                  </div>`;
                }

                cart.addons.forEach(item => {
                    const itemTotal = item.price * item.qty;
                    subtotal += itemTotal;
                    html += `
                  <div class="cart-item">
                      <div class="cart-item-info">
                          <div class="cart-item-name">${item.desc}</div>
                          <div class="cart-item-details">${item.qty} x $${item.price.toFixed(2)}</div>
                      </div>
                      <div class="cart-item-price">$${itemTotal.toFixed(2)}</div>
                  </div>`;
                });

                html += '</div>';
                html += `
              <div class="cart-total-section">
                  <div class="cart-total-row">
                      <span class="cart-total-label">Subtotal</span>
                      <span class="cart-total-value" id="cartSubtotal">$${subtotal.toFixed(2)}</span>
                  </div>
              </div>`;

                cartContent.innerHTML = html;
            }

            if (viewCartBtn) viewCartBtn.addEventListener('click', openCartModal);
            if (closeCartIcon) closeCartIcon.addEventListener('click', closeCartModal);
            if (cartCancelBtn) cartCancelBtn.addEventListener('click', closeCartModal);
            if (checkoutBtn) {
                checkoutBtn.addEventListener('click', () => {
                    alert('Proceeding to checkout...');
                    closeCartModal();
                });
            }

            // Upgrade Feature Modal Logic
            const upgradeModal = document.getElementById('upgradeFeatureModal');
            const closeUpgradeIcon = document.getElementById('closeUpgradeModalIcon');
            const upgradeCancelBtn = document.getElementById('upgradeCancelBtn');
            const upgradeConfirmBtn = document.getElementById('upgradeConfirmBtn');

            function openUpgradeModal() {
                upgradeModal.classList.add('open');
                document.body.style.overflow = 'hidden';
            }

            function closeUpgradeModal() {
                upgradeModal.classList.remove('open');
                document.body.style.overflow = '';
            }

            if (closeUpgradeIcon) closeUpgradeIcon.addEventListener('click', closeUpgradeModal);
            if (upgradeCancelBtn) upgradeCancelBtn.addEventListener('click', closeUpgradeModal);
            if (upgradeConfirmBtn) {
                upgradeConfirmBtn.addEventListener('click', () => {
                    // Collect Cart Data
                    const emailSelect = document.querySelector('.sku-select');
                    if (emailSelect) {
                        const selectedOption = emailSelect.options[emailSelect.selectedIndex];
                        const sku = emailSelect.value;
                        const price = selectedOption.getAttribute('data-price');
                        const desc = selectedOption.getAttribute('data-desc');
                        cart.emailTier = { sku, price, desc };
                    }

                    const addonRows = document.querySelectorAll('.qty-selector');
                    cart.addons = [];
                    addonRows.forEach(row => {
                        const qty = parseInt(row.querySelector('.qty-value').innerText) || 0;
                        if (qty > 0) {
                            cart.addons.push({
                                sku: row.getAttribute('data-sku'),
                                price: parseFloat(row.getAttribute('data-price')),
                                desc: row.getAttribute('data-desc'),
                                qty: qty
                            });
                        }
                    });

                    saveCartToStorage();
                    showToast("Items are added in the cart!");
                    closeUpgradeModal();
                });
            }

            // Caution & Success Modals Logic
            const cautionModal = document.getElementById('cautionDeleteModal');
            const successModal = document.getElementById('successDeleteModal');
            const closeCautionIcon = document.getElementById('closeCautionModalIcon');
            const cautionNoBtn = document.getElementById('cautionNoBtn');
            const cautionYesBtn = document.getElementById('cautionYesBtn');

            function openCautionModal() {
                cautionModal.classList.add('open');
                document.body.style.overflow = 'hidden';
            }

            function closeCautionModal() {
                cautionModal.classList.remove('open');
                document.body.style.overflow = '';
            }

            if (closeCautionIcon) closeCautionIcon.addEventListener('click', closeCautionModal);
            if (cautionNoBtn) cautionNoBtn.addEventListener('click', closeCautionModal);

            if (confirmBtn) {
                confirmBtn.addEventListener('click', () => {
                    // Do not close the first modal, just open the caution one on top
                    openCautionModal();
                });
            }

            // ── Freeze Account Modal Logic ──
            const freezeModal = document.getElementById('cautionFreezeModal');
            const closeFreezeIcon = document.getElementById('closeFreezeModalIcon');
            const freezeNoBtn = document.getElementById('freezeNoBtn');
            const freezeContinueBtn = document.getElementById('freezeContinueBtn');
            const triggerFreezeCard = document.getElementById('triggerFreezeModal');
            const btnFreezeInner = document.getElementById('btnFreezeModalInner');

            function openFreezeModal() {
                if (freezeModal) {
                    freezeModal.classList.add('open');
                    document.body.style.overflow = 'hidden';
                }
            }

            function closeFreezeModal() {
                if (freezeModal) {
                    freezeModal.classList.remove('open');
                    document.body.style.overflow = '';
                }
            }

            // Trigger from Freeze Account card
            if (triggerFreezeCard) triggerFreezeCard.addEventListener('click', (e) => {
                e.preventDefault();
                openFreezeModal();
            });

            // Trigger from the btn-freeze-modal inside deleteAccountModal
            if (btnFreezeInner) btnFreezeInner.addEventListener('click', (e) => {
                e.preventDefault();
                // Close the delete modal first, then open freeze modal
                closeModal();
                openFreezeModal();
            });

            if (closeFreezeIcon) closeFreezeIcon.addEventListener('click', closeFreezeModal);
            if (freezeNoBtn) freezeNoBtn.addEventListener('click', closeFreezeModal);

            if (freezeContinueBtn) {
                freezeContinueBtn.addEventListener('click', async () => {
                    freezeContinueBtn.disabled = true;
                    const originalText = freezeContinueBtn.innerText;
                    freezeContinueBtn.innerText = 'Processing...';

                    const tenantInput = document.getElementById('tenant-id');
                    const tenantIdValue = tenantInput ? tenantInput.value : null;

                    if (!tenantIdValue) {
                        alert('Error: Tenant ID not found.');
                        freezeContinueBtn.disabled = false;
                        freezeContinueBtn.innerText = originalText;
                        return;
                    }

                    try {
                        const response = await csrfFetch("/preview-expression", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({
                                expression_field: "invalid_error",
                                field_id: "a5a7cd90-dffd-4cb2-8b09-a45b46a83be1",
                                fields: {
                                    id: tenantIdValue
                                }
                            })
                        });

                        const result = await response.json();
                        console.log("Freeze account response:", result);

                        // Reload page on success (stay on same page)
                        closeFreezeModal();
                        window.location.reload();

                    } catch (error) {
                        console.error("Error during freeze:", error);
                        alert('An error occurred while freezing your account. Please try again.');
                        freezeContinueBtn.disabled = false;
                        freezeContinueBtn.innerText = originalText;
                    }
                });
            }

            if (cautionYesBtn) {
                cautionYesBtn.addEventListener('click', async () => {
                    cautionYesBtn.disabled = true;
                    const originalText = cautionYesBtn.innerText;
                    cautionYesBtn.innerText = 'Processing...';

                    const tenantInput = document.getElementById('tenant-id');
                    const tenantIdValue = tenantInput ? tenantInput.value : null;

                    if (!tenantIdValue) {
                        alert('Error: Tenant ID not found.');
                        cautionYesBtn.disabled = false;
                        cautionYesBtn.innerText = originalText;
                        return;
                    }

                    try {
                        const response = await csrfFetch("/preview-expression", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify({
                                expression_field: "invalid_error",
                                field_id: "083c1c54-c17a-4efc-8694-33b7f482e9de",
                                fields: {
                                    id: tenantIdValue,
                                }
                            })
                        });

                        const result = await response.json();
                        console.log("Delete account response:", result);

                        // Check for errors in the response
                        if (result.error || (result.result && (result.result.error || (typeof result.result === 'object' && result.result.error)))) {
                            const errorMsg = result.error || (result.result && result.result.error) || 'Deletion failed.';
                            alert('Deprovisioning failed: ' + (typeof errorMsg === 'string' ? errorMsg : JSON.stringify(errorMsg)));
                            cautionYesBtn.disabled = false;
                            cautionYesBtn.innerText = originalText;
                            return;
                        }

                        closeCautionModal();
                        closeModal(); // Also close the underlying delete account modal
                        if (successModal) {
                            successModal.classList.add('open');
                            document.body.style.overflow = 'hidden';
                        }

                        setTimeout(() => {
                            window.location.href = "https://snapapp.com/page/snapapp-enterprise-applications-builder?app=d2f43416-bfe5-49b8-a679-25f6e3d2710a";
                        }, 3000);

                    } catch (error) {
                        console.error("Error during deprovisioning:", error);
                        alert('An error occurred during account deletion. Please try again.');
                        cautionYesBtn.disabled = false;
                        cautionYesBtn.innerText = originalText;
                    }
                });
            }

            // Close on outside click
            window.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal();
                }
                if (e.target === addProductModal) {
                    closeAddProductModal();
                }
                if (e.target === upgradeModal) {
                    closeUpgradeModal();
                }
                if (e.target === cartModal) {
                    closeCartModal();
                }
                if (e.target === cautionModal) {
                    closeCautionModal();
                }
                if (e.target === freezeModal) {
                    closeFreezeModal();
                }
            }
            );
            // Reason Selection Logic
            reasonRadios.forEach(radio => {
                radio.addEventListener('change', () => {
                    if (confirmBtn) {
                        confirmBtn.removeAttribute('disabled');
                    }
                }
                );
            }
            );
        }
        );
        async function fetchInstances() {
            const section = document.getElementById('instances-section');
            const container = document.getElementById('instances-container');
            const tenantInput = document.getElementById('tenant-id');
            const tenantId = tenantInput ? tenantInput.value : null;
            if (!tenantId) {
                console.error("Tenant ID not found in DOM");
                return;
            }
            // Show section (if hidden)
            if (section) section.style.display = 'block';
            try {
                // Fetch environments and metrics in parallel
                const [envResponse, metricResponse] = await Promise.all([
                    csrfFetch("/preview-expression", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            expression_field: "invalid_error",
                            field_id: "16e3e001-b228-41f4-af92-8f6ae202f18c",
                            fields: {
                                id: tenantId,
                            }
                        })
                    }),
                    csrfFetch("/preview-expression", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            expression_field: "invalid_error",
                            field_id: "401ce1c1-321b-454a-81fd-1b20d24a874f",
                            fields: {}
                        })
                    })
                ]);

                const envData = await envResponse.json();
                const metricData = await metricResponse.json();

                console.log("Environments response:", envData);
                console.log("Metrics response:", metricData);

                let parsedEnvs = envData.result;
                if (typeof parsedEnvs === "string") {
                    parsedEnvs = JSON.parse(parsedEnvs);
                }

                let parsedMetrics = metricData.result;
                if (typeof parsedMetrics === "string") {
                    parsedMetrics = JSON.parse(parsedMetrics);
                }

                const envs = parsedEnvs.customer_environments || [];

                // Update freeze buttons based on environment status
                const envStatus = envs.length > 0 ? envs[0].status : null;
                if (envStatus === 'frozen') {
                    // Show Unfreeze button → redirect to order-summary
                    const unfreezeUrl = `https://snapapp.com/page/order-summary/${tenantId}?app=d2f43416-bfe5-49b8-a679-25f6e3d2710a`;
                    ['triggerFreezeModal', 'btnFreezeModalInner'].forEach(btnId => {
                        const btn = document.getElementById(btnId);
                        if (!btn) return;
                        const newBtn = btn.cloneNode(true);
                        btn.parentNode.replaceChild(newBtn, btn);
                        newBtn.innerHTML = '<span class="material-icons">ac_unit</span>&nbsp;Unfreeze Your Account';
                        newBtn.addEventListener('click', (e) => {
                            e.preventDefault();
                            window.location.href = unfreezeUrl;
                        });
                    });
                } else if (envStatus === 'claimed') {
                    // Show Freeze button → existing modal logic already attached, no changes needed
                }

                if (envs.length === 0) {
                    if (container) container.innerHTML = `
<div class="empty-state">
<span class="material-icons empty-state-icon">dns</span>
<p class="empty-state-text">You have not created any instances yet.</p>
    </div>`;
                    return;
                }

                // Helper to format capacity
                const formatNumber = (num) => (num || 0).toLocaleString();

                // Extract metrics from the second call
                const m = parsedMetrics || {};
                const metricsList = [
                    { key: 'users', val: m.users, limit: m.max_users, label: 'users', circle: 'seats' },
                    { key: 'objects', val: m.objects, limit: m.max_objects, label: 'objects', circle: 'objects' },
                    { key: 'records', val: m.records, limit: m.max_records, label: 'records', circle: 'records' },
                    { key: 'workflow', val: m.workflow_execution, limit: m.max_workflow_execution, label: 'API calls', circle: 'workflow' },
                    { key: 'storage', val: m.storage, limit: m.max_storage, label: 'storage', circle: 'storage', isStorage: true },
                    { key: 'emails', val: m.emails, limit: m.max_emails, label: 'emails', circle: 'emails' },
                    { key: 'sms', val: m.sms, limit: m.max_sms, label: 'SMS', circle: 'sms' }
                ];

                if (container) {
                    container.innerHTML = envs.map(env => {
                        const metricsHtml = metricsList.map(metric => {
                            const val = metric.val || 0;
                            const limit = metric.limit || 0;
                            const pct = limit > 0 ? Math.min((val / limit) * 100, 100) : 0;

                            let displayVal = formatNumber(val);
                            let displayLimit = formatNumber(limit);

                            if (metric.isStorage) {
                                displayVal = (val / 1e9).toFixed(2) + " GB";
                                displayLimit = (limit / 1e9).toFixed(1) + " GB";
                            }

                            return `
                <div class="metric-group">
                  <div class="ring-chart">
                    <svg viewBox="0 0 36 36" class="circular-chart">
                      <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                      <path class="circle circle-${metric.circle}" stroke-dasharray="${pct}, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                    </svg>
                  </div>
                  <span class="metric-text">${displayVal} of ${displayLimit} ${metric.label}</span>
                </div>
              `;
                        }).join('');

                        // Trial Badge Logic
                        let trialBadgeHtml = '';
                        const daysLeft = env.days_left_in_trial;
                        if (daysLeft !== null && daysLeft !== undefined && daysLeft !== '') {
                            const daysNum = parseInt(daysLeft);
                            if (!isNaN(daysNum)) {
                                const upgradeUrl = `https://snapapp.com/page/plan-details/${tenantId}?app=${env.application_id || 'd2f43416-bfe5-49b8-a679-25f6e3d2710a'}`;
                                if (daysNum > 0) {
                                    trialBadgeHtml = `
                    <div class="trial-badge trial-badge-active">
                      <span class="material-icons">timer</span>
                      <span>${daysNum} Days Left in Trial, <a href="${upgradeUrl}" class="upgrade-link">Upgrade Now</a></span>
                    </div>
                  `;
                                } else if (daysNum === 0) {
                                    trialBadgeHtml = `
                    <div class="trial-badge trial-badge-expired">
                      <span class="material-icons">warning</span>
                      <span>Your free trial has expired, please <a href="${upgradeUrl}" class="upgrade-link">Upgrade Now</a></span>
                    </div>
                  `;
                                }
                            }
                        }

                        return `
<div class="instance-card">
  <div class="instance-card-left">
    <div class="instance-info">
      <h3>${env.domain}</h3>
      ${trialBadgeHtml}
    </div>
    <div class="instance-metrics">
      ${metricsHtml}
    </div>
  </div>
  <div class="instance-card-right">
    <button class="instance-open-btn" data-domain="${env.domain}">
      <span class="material-icons" style="font-size: 18px;">open_in_new</span>
      Open
    </button>
  </div>
</div>
`;
                    }).join('');
                }
            }
            catch (e) {
                console.error("Fetch error", e);
                if (container) container.innerHTML = `<div class="empty-state"><p class="empty-state-text" style="color: #d32f2f;">Error loading instances</p></div>`;
            }
        }
        // Function to fetch and display products
        async function fetchProducts() {
            const container = document.getElementById('products-container');
            const tenantInput = document.getElementById('tenant-id');
            const tenantId = tenantInput ? tenantInput.value : null;
            if (!tenantId) {
                console.error("Tenant ID not found in DOM");
                if (container) container.innerHTML = `
<div class="empty-state">
<span class="material-icons empty-state-icon">inventory_2</span>
<p class="empty-state-text">Unable to load products. Tenant ID not found.</p>
    </div>`;
                return;
            }
            try {
                const response = await csrfFetch("/preview-expression", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    }
                    ,
                    body: JSON.stringify({
                        expression_field: "invalid_error",
                        field_id: "2eb8a044-61ae-4309-b777-418c20f7dbcd",
                        fields: {
                            id: tenantId,
                        }
                    }
                    )
                }
                );
                const data = await response.json();
                console.log("Products API response:", data);
                let parsedResult = data.result;
                if (typeof parsedResult === "string") {
                    parsedResult = JSON.parse(parsedResult);
                }
                const listings = parsedResult.listings || [];

                // Check if there are any products
                window.hasSubscribedProducts = listings.length > 0;
                if (typeof window.updateViewCartBtnVisibility === 'function') {
                    window.updateViewCartBtnVisibility();
                }

                if (listings.length === 0) {
                    if (container) container.innerHTML = `
<div class="empty-state">
<span class="material-icons empty-state-icon">inventory_2</span>
<p class="empty-state-text">You have not subscribed to any products yet.</p>
    </div>`;
                    return;
                }
                // Generate product cards
                if (container) {
                    container.innerHTML = listings
                        .filter(listing => listing.active === 1) // Only show active listings
                        .map(listing => {
                            // Construct the full image URL
                            const imageUrl = listing.primary_image
                                ? `https://storage.googleapis.com/${listing.primary_image}`
                                : '';

                            // Use 'Upgrade Feature' if type matches, otherwise no button
                            const isUpgrade = listing.type === 'Upgrade Feature';

                            return `
<div class="product-card">
<div class="product-image-container">
${imageUrl ? `<img src="${imageUrl}" alt="${listing.title}" class="product-image" onerror="this.style.display='none'">` : ''}
    </div>
<div class="product-content">
<h3 class="product-title">${listing.title}</h3>
<p class="product-subtitle">${listing.subtitle}</p>
    </div>
${isUpgrade ? `
<div class="product-footer">
<button class="product-btn" data-action="Upgrade Feature">Add Features</button>
    </div>
` : ''}
    </div>
`;
                        }
                        ).join('');

                    // Attach event listeners to buttons
                    const buttons = container.querySelectorAll('.product-btn');
                    buttons.forEach(btn => {
                        btn.addEventListener('click', () => {
                            const action = btn.getAttribute('data-action');
                            if (action === 'Upgrade Feature') {
                                handleUpgradeFeature();
                            }
                        });
                    });
                }
            }
            catch (e) {
                console.error("Fetch products error", e);
                if (container) container.innerHTML = `
<div class="empty-state">
<span class="material-icons empty-state-icon" style="color: #d32f2f;">error</span>
<p class="empty-state-text" style="color: #d32f2f;">Error loading products. Please try again later.</p>
    </div>`;
            }
        }

        // Function to handle Upgrade Feature click
        async function handleUpgradeFeature() {
            const skuContainer = document.getElementById('sku-container');
            const upgradeModal = document.getElementById('upgradeFeatureModal');

            // Open modal immediately to show loader
            upgradeModal.classList.add('open');
            document.body.style.overflow = 'hidden';

            if (skuContainer) {
                skuContainer.innerHTML = `
          <div class="sku-loader">
            <span class="material-icons">refresh</span>
            <p>Fetching available upgrades...</p>
          </div>
        `;
            }

            try {
                const response = await csrfFetch("/preview-expression", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        expression_field: "invalid_error",
                        field_id: "cd7b9cb2-e502-4ccf-baf5-85434b7543c5",
                        fields: {}
                    })
                });

                const data = await response.json();
                console.log("SKU API response:", data);

                let skus = data.result;
                if (typeof skus === "string") {
                    skus = JSON.parse(skus);
                }

                if (!Array.isArray(skus)) {
                    throw new Error("Invalid SKU data format");
                }

                // Categorize SKUs
                const emailSkus = skus.filter(s => s["SKU #"].startsWith('EML-'));
                const quantitySkus = skus.filter(s => ['OBJ-100', 'STR-1GB', 'SMS-ADD'].includes(s["SKU #"]));

                let html = '';

                // Email Tiers Group
                if (emailSkus.length > 0) {
                    html += `
            <div class="sku-group-label">
              <span class="material-icons">email</span> Email Volume
            </div>
            <div class="sku-item">
              <div class="sku-info">
                <div class="sku-name">Monthly Email Tier</div>
                <div class="sku-price">Select your required volume per month</div>
              </div>
              <div class="sku-control" style="min-width: 300px;">
                <select class="sku-select">
                  ${emailSkus.map(s => {
                        return `<option value="${s["SKU #"]}" data-price="${s["Unit Price"]}" data-desc="${s["Description"]}">${s["Description"]} - $${s["Unit Price"]}</option>`;
                    }).join('')}
                </select>
              </div>
            </div>
          `;
                }

                // Quantity Items Group
                if (quantitySkus.length > 0) {
                    html += `
            <div class="sku-group-label">
              <span class="material-icons">add_box</span> Add-on Items
            </div>
            <div class="sku-list">
              ${quantitySkus.map(s => {
                        const name = s["Description"];
                        let priceDisplay = `$${s["Unit Price"]} per month`;

                        if (s["SKU #"] === 'SMS-ADD') {
                            priceDisplay = `$${s["Unit Price"]} per SMS`;
                        }

                        return `
                <div class="sku-item">
                  <div class="sku-info">
                    <div class="sku-name">${name}</div>
                    <div class="sku-price">${priceDisplay}</div>
                  </div>
                  <div class="sku-control">
                    <div class="qty-selector" data-sku="${s["SKU #"]}" data-price="${s["Unit Price"]}" data-desc="${name}">
                      <button class="qty-btn qty-minus" disabled>
                        <span class="material-icons">remove</span>
                      </button>
                      <span class="qty-value">0</span>
                      <button class="qty-btn qty-plus">
                        <span class="material-icons">add</span>
                      </button>
                    </div>
                  </div>
                </div>
              `}).join('')}
            </div>
          `;
                }

                if (skuContainer) {
                    skuContainer.innerHTML = html || '<p>No upgrade options available at this time.</p>';

                    // Add quantity selector logic
                    skuContainer.querySelectorAll('.qty-selector').forEach(selector => {
                        const minusBtn = selector.querySelector('.qty-minus');
                        const plusBtn = selector.querySelector('.qty-plus');
                        const valueSpan = selector.querySelector('.qty-value');

                        minusBtn.addEventListener('click', () => {
                            let val = parseInt(valueSpan.innerText) || 0;
                            if (val > 0) {
                                val--;
                                valueSpan.innerText = val;
                                if (val === 0) minusBtn.disabled = true;
                            }
                        });

                        plusBtn.addEventListener('click', () => {
                            let val = parseInt(valueSpan.innerText) || 0;
                            val++;
                            valueSpan.innerText = val;
                            minusBtn.disabled = false; // Enable minus button as soon as value > 0
                        });
                    });
                }

            } catch (e) {
                console.error("Fetch SKUs error", e);
                if (skuContainer) skuContainer.innerHTML = `
          <div class="empty-state">
            <span class="material-icons" style="color: #d32f2f;">error</span>
            <p style="color: #d32f2f;">Unable to fetch upgrade options. Please try again.</p>
          </div>
        `;
            }
        }
        // Call fetchProducts when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            fetchProducts();
        }
        );
    </script>
</body>
<style nonce="Swd7LzZnOc-_yhh8IVRfqyv3oQ-PtmNx">
    * {
        box-sizing: border-box;
    }

    body {
        margin: 0;
    }

    * {
        box-sizing: border-box;
        margin-bottom: 0px;
        margin-left: 0px;
        margin-right: 0px;
        margin-top: 0px;
        padding-bottom: 0px;
        padding-left: 0px;
        padding-right: 0px;
        padding-top: 0px;
    }

    body {
        background-color: white !important;
        color: rgb(26, 26, 26);
        font-family: Roboto, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        min-height: 100vh;
    }

    .main-container {
        margin-bottom: 0px;
        margin-left: auto;
        margin-right: auto;
        margin-top: 0px;
        max-width: 1400px;
        padding-bottom: 37px !important;
        padding-left: 20px;
        padding-right: 20px;
        padding-top: 37px !important;
    }

    .page-header {
        margin-bottom: 24px;
    }

    .page-title {
        color: rgb(25, 118, 210);
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 0px;
        margin-left: 0px;
        margin-right: 0px;
        margin-top: 0px;
    }

    .tab-navigation {
        column-gap: 16px;
        display: flex;
        margin-bottom: 32px;
        padding-bottom: 0px;
        row-gap: 16px;
    }

    .tab-button {
        align-items: center;
        background-attachment: initial;
        background-clip: initial;
        background-color: transparent;
        background-image: initial;
        background-origin: initial;
        background-position-x: initial;
        background-position-y: initial;
        background-repeat: initial;
        background-size: initial;
        border-bottom-color: transparent;
        border-bottom-style: solid;
        border-bottom-width: 3px;
        border-image-outset: initial;
        border-image-repeat: initial;
        border-image-slice: initial;
        border-image-source: initial;
        border-image-width: initial;
        border-left-color: initial;
        border-left-style: none;
        border-left-width: initial;
        border-right-color: initial;
        border-right-style: none;
        border-right-width: initial;
        border-top-color: initial;
        border-top-style: none;
        border-top-width: initial;
        bottom: -1px;
        color: rgb(95, 99, 104);
        column-gap: 8px;
        cursor: pointer;
        display: flex;
        font-size: 1rem;
        font-weight: 500;
        padding-bottom: 12px;
        padding-left: 20px;
        padding-right: 20px;
        padding-top: 12px;
        position: relative;
        row-gap: 8px;
        transition-behavior: normal;
        transition-delay: 0s;
        transition-duration: 0.3s;
        transition-property: all;
        transition-timing-function: ease;
    }

    .tab-button .material-icons {
        font-size: 20px;
    }

    .tab-button:hover {
        background-color: rgba(25, 118, 210, 0.04);
        color: rgb(25, 118, 210);
    }

    .tab-button:focus {
        outline-color: initial !important;
        outline-style: none !important;
        outline-width: initial !important;
    }

    .tab-button.active {
        background-color: transparent !important;
        border-bottom-color: rgb(25, 118, 210);
        color: rgb(25, 118, 210) !important;
        font-weight: 600;
    }

    .tab-content {
        animation-delay: 0s;
        animation-direction: normal;
        animation-duration: 0.3s;
        animation-fill-mode: none;
        animation-iteration-count: 1;
        animation-name: fadeIn;
        animation-play-state: running;
        animation-range-end: normal;
        animation-range-start: normal;
        animation-timeline: auto;
        animation-timing-function: ease;
        display: none;
    }

    .tab-content.active {
        background-color: white !important;
        display: block;
    }

    .card-section {
        background-attachment: initial;
        background-clip: initial;
        background-color: white;
        background-image: initial;
        background-origin: initial;
        background-position-x: initial;
        background-position-y: initial;
        background-repeat: initial;
        background-size: initial;
        border-bottom-color: rgb(229, 231, 235);
        border-bottom-left-radius: 16px;
        border-bottom-right-radius: 16px;
        border-bottom-style: solid;
        border-bottom-width: 2px;
        border-image-outset: initial;
        border-image-repeat: initial;
        border-image-slice: initial;
        border-image-source: initial;
        border-image-width: initial;
        border-left-color: rgb(229, 231, 235);
        border-left-style: solid;
        border-left-width: 2px;
        border-right-color: rgb(229, 231, 235);
        border-right-style: solid;
        border-right-width: 2px;
        border-top-color: rgb(229, 231, 235);
        border-top-left-radius: 16px;
        border-top-right-radius: 16px;
        border-top-style: solid;
        border-top-width: 2px;
        padding-bottom: 32px;
        padding-left: 32px;
        padding-right: 32px;
        padding-top: 25px !important;
        transition-behavior: normal;
        transition-delay: 0s;
        transition-duration: 0.3s;
        transition-property: all;
        transition-timing-function: ease;
    }

    .card-section:hover {
        transform: translateY(-2px);
    }

    .card-title {
        color: rgb(26, 26, 26);
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 24px;
    }

    .card-header {
        align-items: center;
        column-gap: 12px;
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        margin-bottom: 24px;
        padding-bottom: 0px !important;
        padding-left: 0px !important;
        padding-right: 0px !important;
        padding-top: 0px !important;
        row-gap: 12px;
    }

    .card-header .card-title {
        margin-bottom: 0px;
    }

    .card-subtitle {
        color: rgb(102, 102, 102);
        font-size: 0.95rem;
        line-height: 1.6;
        margin-bottom: 24px;
    }

    .form-grid {
        column-gap: 32px;
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        row-gap: 15px !important;
    }

    .form-group {
        column-gap: 8px;
        display: flex;
        flex-direction: column;
        row-gap: 8px;
    }

    .form-group.full-width {
        grid-column-end: auto;
        grid-column-start: span 2;
    }

    .form-label {
        color: rgb(95, 99, 104);
        font-size: 0.9rem;
        font-weight: 500;
    }

    .form-input {
        background-color: rgb(248, 249, 250);
        border-bottom-color: rgb(224, 224, 224);
        border-bottom-left-radius: 8px;
        border-bottom-right-radius: 8px;
        border-bottom-style: solid;
        border-bottom-width: 1px;
        border-image-outset: initial;
        border-image-repeat: initial;
        border-image-slice: initial;
        border-image-source: initial;
        border-image-width: initial;
        border-left-color: rgb(224, 224, 224);
        border-left-style: solid;
        border-left-width: 1px;
        border-right-color: rgb(224, 224, 224);
        border-right-style: solid;
        border-right-width: 1px;
        border-top-color: rgb(224, 224, 224);
        border-top-left-radius: 8px;
        border-top-right-radius: 8px;
        border-top-style: solid;
        border-top-width: 1px;
        color: rgb(26, 26, 26);
        font-size: 1rem;
        padding-bottom: 12px;
        padding-left: 16px;
        padding-right: 16px;
        padding-top: 12px;
        transition-behavior: normal;
        transition-delay: 0s;
        transition-duration: 0.2s;
        transition-property: all;
        transition-timing-function: ease;
        width: 100%;
    }

    .form-input:focus {
        background-color: white;
        border-bottom-color: rgb(25, 118, 210);
        border-left-color: rgb(25, 118, 210);
        border-right-color: rgb(25, 118, 210);
        border-top-color: rgb(25, 118, 210);
        box-shadow: rgba(25, 118, 210, 0.1) 0px 0px 0px 4px;
        outline-color: initial;
        outline-style: none;
        outline-width: initial;
    }

    .form-input:disabled,
    .form-input[readonly] {
        background-color: rgb(248, 249, 250);
        color: rgb(26, 26, 26);
        cursor: default;
    }

    .management-grid {
        column-gap: 32px;
        display: grid;
        grid-template-columns: 1fr 1fr;
        row-gap: 32px;
    }

    .btn-upgrade {
        align-items: center;
        background-color: rgb(219, 233, 254) !important;
        border-bottom-color: rgba(29, 63, 176, 0.133) !important;
        border-bottom-left-radius: 8px;
        border-bottom-right-radius: 8px;
        border-left-color: rgba(29, 63, 176, 0.133) !important;
        border-right-color: rgba(29, 63, 176, 0.133) !important;
        border-top-color: rgba(29, 63, 176, 0.133) !important;
        border-top-left-radius: 8px;
        border-top-right-radius: 8px;
        color: rgb(29, 64, 176) !important;
        cursor: pointer;
        display: inline-flex;
        font-size: 1rem;
        font-weight: 600;
        justify-content: center;
        padding-bottom: 12px;
        padding-left: 15px;
        padding-right: 15px;
        padding-top: 12px;
        transition-behavior: normal;
        transition-delay: 0s;
        transition-duration: 0.2s;
        transition-property: all;
        transition-timing-function: ease;
    }

    .btn-upgrade:hover {
        background-color: rgb(219, 233, 254) !important;
        color: rgb(29, 64, 176) !important;
        transform: translateY(-1px);
    }

    .btn-upgrade:focus {
        box-shadow: none !important;
        outline-color: initial !important;
        outline-style: none !important;
        outline-width: initial !important;
    }

    .btn-danger-soft {
        align-items: center;
        background-color: rgb(219, 233, 254) !important;
        border-bottom-color: rgba(29, 63, 176, 0.133) !important;
        border-bottom-left-radius: 8px;
        border-bottom-right-radius: 8px;
        border-left-color: rgba(29, 63, 176, 0.133) !important;
        border-right-color: rgba(29, 63, 176, 0.133) !important;
        border-top-color: rgba(29, 63, 176, 0.133) !important;
        border-top-left-radius: 8px;
        border-top-right-radius: 8px;
        color: rgb(29, 64, 176) !important;
        cursor: pointer;
        display: inline-flex;
        font-size: 1rem;
        font-weight: 600;
        justify-content: center;
        padding-bottom: 12px;
        padding-left: 15px;
        padding-right: 15px;
        padding-top: 12px;
        transition-behavior: normal;
        transition-delay: 0s;
        transition-duration: 0.2s;
        transition-property: all;
        transition-timing-function: ease;
    }

    .btn-danger-soft:hover {
        background-color: rgb(219, 233, 254) !important;
        color: rgb(29, 64, 176) !important;
        transform: translateY(-1px);
    }

    .btn-danger-soft:focus {
        outline-color: initial !important;
        outline-style: none !important;
        outline-width: initial !important;
    }

    .btn-danger {
        align-items: center;
        background-color: rgb(254, 219, 219) !important;
        border-bottom-color: rgba(176, 29, 29, 0.13) !important;
        border-bottom-left-radius: 8px;
        border-bottom-right-radius: 8px;
        border-left-color: rgba(176, 29, 29, 0.13) !important;
        border-right-color: rgba(176, 29, 29, 0.13) !important;
        border-top-color: rgba(176, 29, 29, 0.13) !important;
        border-top-left-radius: 8px;
        border-top-right-radius: 8px;
        color: rgb(176, 29, 29) !important;
        cursor: pointer;
        display: inline-flex;
        font-size: 1rem;
        font-weight: 600;
        justify-content: center;
        padding-bottom: 12px;
        padding-left: 15px;
        padding-right: 15px;
        padding-top: 12px;
        transition-behavior: normal;
        transition-delay: 0s;
        transition-duration: 0.2s;
        transition-property: all;
        transition-timing-function: ease;
    }

    .btn-danger:hover {
        background-color: rgb(254, 219, 219) !important;
        color: rgb(176, 29, 29) !important;
        transform: translateY(-1px);
    }

    .btn-danger:focus {
        box-shadow: none !important;
        outline-color: initial !important;
        outline-style: none !important;
        outline-width: initial !important;
    }

    .tab-action-btn {
        align-items: center;
        background-color: rgb(219, 233, 254) !important;
        border-bottom-color: rgba(29, 63, 176, 0.133) !important;
        border-bottom-left-radius: 8px;
        border-bottom-right-radius: 8px;
        border-left-color: rgba(29, 63, 176, 0.133) !important;
        border-right-color: rgba(29, 63, 176, 0.133) !important;
        border-top-color: rgba(29, 63, 176, 0.133) !important;
        border-top-left-radius: 8px;
        border-top-right-radius: 8px;
        color: rgb(29, 64, 176) !important;
        display: inline-flex;
        font-size: 0.9rem;
        font-weight: 500;
        height: 40px;
        justify-content: center;
        padding-bottom: 10px;
        padding-left: 15px;
        padding-right: 15px;
        padding-top: 10px;
        text-decoration-color: initial;
        text-decoration-line: none;
        text-decoration-style: initial;
        text-decoration-thickness: initial;
        transition-behavior: normal;
        transition-delay: 0s;
        transition-duration: 0.2s;
        transition-property: all;
        transition-timing-function: ease;
    }

    .tab-action-btn:focus {
        outline-color: initial !important;
        outline-style: none !important;
        outline-width: initial !important;
    }

    .tab-action-btn:hover {
        background-color: rgb(191, 219, 254) !important;
        color: rgb(29, 64, 176) !important;
        transform: translateY(-1px);
    }

    a {
        text-decoration-color: initial !important;
        text-decoration-line: none !important;
        text-decoration-style: initial !important;
        text-decoration-thickness: initial !important;
    }

    #instances-section {
        display: none;
        margin-top: 32px;
    }

    #id9cv {
        display: flex;
        justify-content: center;
        padding: 40px;
    }

    #iza0a {
        animation: spin 1s linear infinite;
        color: #1976d2;
        font-size: 32px;
    }

    #ivxi3 {
        margin-top: auto;
    }

    #iobgt {
        margin-top: auto;
    }

    #ilhnk {
        margin-top: auto;
    }

    #i3s5nz {
        margin-top: auto;
    }

    #addNewProductTrigger {
        border: none;
        cursor: pointer;
    }

    #i5gaiw {
        display: flex;
        justify-content: center;
        padding: 40px;
    }

    #ij24rn {
        animation: spin 1s linear infinite;
        color: #1976d2;
        font-size: 32px;
    }

    @keyframes fadeIn {
        0% {
            opacity: 0;
            transform: translateY(10px);
        }

        100% {
            opacity: 1;
            transform: translateY(0px);
        }
    }

    @media (max-width: 900px) {
        .management-grid {
            grid-template-columns: 1fr;
        }
    }

    @media (max-width: 768px) {
        .main-container {
            padding-bottom: 24px;
            padding-left: 16px;
            padding-right: 16px;
            padding-top: 24px;
        }

        .page-title {
            font-size: 1.8rem;
        }

        .form-grid {
            column-gap: 20px;
            grid-template-columns: 1fr;
            row-gap: 20px;
        }

        .form-group.full-width {
            grid-column-end: auto;
            grid-column-start: span 1;
        }

        .tab-navigation {
            border-bottom-color: initial;
            border-bottom-style: none;
            border-bottom-width: initial;
            column-gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 24px;
            overflow-x: visible;
            row-gap: 10px;
            text-wrap-mode: wrap;
            white-space-collapse: collapse;
        }

        .tab-button {
            background-color: rgb(245, 247, 249);
            border-bottom-color: initial;
            border-bottom-left-radius: 8px;
            border-bottom-right-radius: 8px;
            border-bottom-style: none;
            border-bottom-width: initial;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            color: rgb(95, 99, 104);
            flex-basis: 45%;
            flex-grow: 1;
            flex-shrink: 1;
            justify-content: center;
            margin-bottom: 4px;
            padding-bottom: 12px;
            padding-left: 12px;
            padding-right: 12px;
            padding-top: 12px;
        }

        .tab-button.active {
            background-color: rgb(227, 242, 253) !important;
            border-bottom-color: initial !important;
            border-bottom-style: none !important;
            border-bottom-width: initial !important;
            color: rgb(25, 118, 210) !important;
            font-weight: 600;
        }

        .tab-button:hover {
            background-color: rgb(227, 242, 253);
        }

        .tab-action-btn {
            display: flex;
            justify-content: center;
            margin-left: 0px;
            margin-top: 8px;
            order: 99;
            width: 100%;
        }

        .tab-action-btn:focus {
            outline-color: initial !important;
            outline-style: none !important;
            outline-width: initial !important;
        }

        .card-section {
            padding-bottom: 24px;
            padding-left: 20px;
            padding-right: 20px;
            padding-top: 24px;
        }

        .btn-danger {
            margin-top: 12px;
            width: 100%;
        }

        .btn-danger-soft {
            margin-top: 12px;
            width: 100%;
        }
    }
</style>
